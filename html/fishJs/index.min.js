function loadImages(t,s){var i=0,h=0,n={};for(var e in t){h++;var o=new Image;n[e]=o,o.onload=function(){i++,i==h&&s&&s(n)},o.src=t[e]}}function d2a(t){return t*Math.PI/180}function a2d(t){return 180*t/Math.PI}function rnd(t,s){return Math.floor(Math.random()*(s-t)+t)}function Sprite(t){this.oImg=t,this.w=0,this.h=0,this.sx=0,this.sy=0,this.x=0,this.y=0,this.speed=0,this.rotate=0}function Fish(t,s){Sprite.call(this,t["fish"+s]);var i=[null,{h:55,w:37},{h:78,w:64},{h:72,w:56},{h:77,w:59},{h:107,w:122}];this.w=i[s].w,this.h=i[s].h,this.rotate=90,this.speed=rnd(2,5),this.count=0,this.type=s}function Cannon(t,s){Sprite.call(this,t["cannon"+s]);var i=[null,{w:74,h:74},{w:74,h:76},{w:74,h:76},{w:74,h:83},{w:74,h:85},{w:74,h:90},{w:74,h:94}];this.w=i[s].w,this.h=i[s].h,this.type=s}function Bullet(t,s){Sprite.call(this,t);var i=[null,{sx:86,sy:0,w:24,h:26},{sx:61,sy:0,w:25,h:29},{sx:32,sy:35,w:27,h:31},{sx:30,sy:82,w:29,h:33},{sx:0,sy:82,w:30,h:34},{sx:30,sy:0,w:31,h:35},{sx:0,sy:0,w:30,h:44}];this.sx=i[s].sx,this.sy=i[s].sy,this.w=i[s].w,this.h=i[s].h}function Coin(t,s){switch(s){case 1:case 2:case 3:s=1;break;case 4:case 5:s=2}Sprite.call(this,t["coinAni"+s]);var i=[null,{w:60,h:60},{w:60,h:60}];this.w=i[s].w,this.h=i[s].h,this.type=s,this.count=0}function DieFish(t,s){Sprite.call(this,t["fish"+s]);var i=[null,{h:55,w:37},{h:78,w:64},{h:72,w:56},{h:77,w:59},{h:107,w:122}];this.w=i[s].w,this.h=i[s].h,this.rotate=90,this.count=0,this.sx=4*this.w,this.type=s}function Web(t,s){Sprite.call(this,t);var i=[null,{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200}];this.w=i[s].w,this.h=i[s].h,this.type=s,this.scale=.5}Sprite.prototype.draw=function(t){t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),t.drawImage(this.oImg,this.sx,this.sy,this.w,this.h,-this.w/2,-this.h/2,this.w,this.h),t.restore()},Sprite.prototype.move=function(){var t=Math.cos(d2a(this.rotate-90))*this.speed,s=Math.sin(d2a(this.rotate-90))*this.speed;this.x+=t,this.y+=s},Sprite.prototype.collTest=function(t){var s=Math.abs(this.w,this.h)/2,i=Math.abs(t.w,t.h)/2,h=this.x-t.x,n=this.y-t.y,e=Math.sqrt(h*h+n*n);return e<=.5*(s+i)},Fish.prototype=new Sprite,Fish.prototype.constructor=Fish;var oldMove=Sprite.prototype.move;Fish.prototype.move=function(){oldMove.call(this),this.count%4==0&&(this.sx+=this.w,this.sx>=4*this.w&&(this.sx=0)),this.count++},Cannon.prototype=new Sprite,Cannon.prototype.constructor=Cannon,Bullet.prototype=new Sprite,Bullet.prototype.constructor=Bullet,Coin.prototype=new Sprite,Coin.prototype.constructor=Coin,Coin.prototype.move=function(){this.count%4==0&&(this.sy+=this.h,this.sy>9*this.h&&(this.sy=0)),this.count++,this.x+=(0-this.x)/20,this.y+=(700-this.y)/20},DieFish.prototype=new Sprite,DieFish.prototype.constructor=DieFish,DieFish.prototype.move=function(){this.count%4==0&&(this.sx+=this.w,this.sx>=8*this.w&&(this.sx=4*this.w)),this.count++},Web.prototype=new Sprite,Web.prototype.constructor=Web,Web.prototype.draw=function(t){t.save(),t.translate(this.x,this.y),t.scale(this.scale,this.scale),t.drawImage(this.oImg,this.sx,this.sy,this.w,this.h,-this.w/2,-this.h/2,this.w,this.h),t.restore()},window.onload=function(){var t=document.getElementById("c1"),s=t.getContext("2d");loadImages({fish1:"fishImg/fish1.png",fish2:"fishImg/fish2.png",fish3:"fishImg/fish3.png",fish4:"fishImg/fish4.png",fish5:"fishImg/fish5.png",bottom:"fishImg/bottom.png",bullet:"fishImg/bullet.png",cannon1:"fishImg/cannon1.png",cannon2:"fishImg/cannon2.png",cannon3:"fishImg/cannon3.png",cannon4:"fishImg/cannon4.png",cannon5:"fishImg/cannon5.png",cannon6:"fishImg/cannon6.png",cannon7:"fishImg/cannon7.png",coinAni1:"fishImg/coinAni1.png",coinAni2:"fishImg/coinAni2.png",web:"fishImg/web.png"},function(i){var h=[];setInterval(function(){var s=new Fish(i,rnd(1,6));Math.random()<.5?s.x=-100:(s.x=t.width+100,s.rotate=-90),s.y=rnd(0,t.height),h.push(s)},100);var n=new Sprite(i.bottom);n.w=764,n.h=70,n.x=t.width/2,n.y=t.height-n.h/2;var e=new Cannon(i,7);e.x=434,e.y=560,t.onmousemove=function(s){var i=s.clientX-t.offsetLeft-e.x,h=t.offsetTop+e.y-s.clientY,n=90-a2d(Math.atan2(h,i));e.rotate=n};var o=[];t.onclick=function(){var t=new Bullet(i.bullet,e.type);t.x=e.x,t.y=e.y,t.speed=5,t.rotate=e.rotate,o.push(t)};var r=[],a=[],c=[];setInterval(function(){s.clearRect(0,0,t.width,t.height);for(var w=0;w<h.length;w++)h[w].draw(s),h[w].move();n.draw(s),e.draw(s);for(var w=0;w<o.length;w++)o[w].draw(s),o[w].move();for(var w=0;w<r.length;w++)r[w].draw(s),r[w].move();for(var w=0;w<a.length;w++)a[w].draw(s),a[w].move(),setTimeout(function(){a.splice(w--,1)},300);for(var w=0;w<c.length;w++)c[w].draw(s),c[w].scale+=.1,c[w].scale>1.2&&(c[w].scale=1,c.splice(w--,1));for(var w=0;w<o.length;w++)for(var p=0;p<h.length;p++)if(o[w].collTest(h[p])){var l=h[p].x,y=h[p].y,u=h[p].type;h[p].rotate;h.splice(p--,1),o.splice(w--,1);var g=new Coin(i,u);g.x=l,g.y=y,r.push(g);var x=new DieFish(i,u);x.x=l,x.y=y,a.push(x);var f=new Web(i.web,u);f.x=l,f.y=y,c.push(f)}for(var w=0;w<h.length;w++)(h[w].x<-100||h[w].x>=t.width+100||h[w].y<-100||h[w].y>t.height+100)&&h.splice(w--,1);for(var w=0;w<o.length;w++)(o[w].x<-100||o[w].x>=t.width+100||o[w].y<-100||o[w].y>t.height+100)&&o.splice(w--,1)},30)})};